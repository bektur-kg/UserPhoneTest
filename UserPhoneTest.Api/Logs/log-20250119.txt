2025-01-19 04:14:39.992 +06:00 [INF] Now listening on: https://localhost:7292
2025-01-19 04:14:40.048 +06:00 [INF] Now listening on: http://localhost:5229
2025-01-19 04:14:40.307 +06:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-19 04:14:40.309 +06:00 [INF] Hosting environment: Development
2025-01-19 04:14:40.309 +06:00 [INF] Content root path: D:\Projects\UserPhoneTest\UserPhoneTest.Api
2025-01-19 04:14:41.836 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/swagger - null null
2025-01-19 04:14:42.027 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/swagger - 301 0 null 201.9367ms
2025-01-19 04:14:42.031 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/swagger/index.html - null null
2025-01-19 04:14:42.109 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/swagger/index.html - 200 null text/html;charset=utf-8 77.1859ms
2025-01-19 04:14:42.116 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/_framework/aspnetcore-browser-refresh.js - null null
2025-01-19 04:14:42.115 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/swagger/swagger-ui-bundle.js - null null
2025-01-19 04:14:42.115 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/swagger/swagger-ui.css - null null
2025-01-19 04:14:42.124 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/_vs/browserLink - null null
2025-01-19 04:14:42.115 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/swagger/swagger-ui-standalone-preset.js - null null
2025-01-19 04:14:42.139 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/_framework/aspnetcore-browser-refresh.js - 200 13786 application/javascript; charset=utf-8 23.6028ms
2025-01-19 04:14:42.202 +06:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-01-19 04:14:42.202 +06:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-01-19 04:14:42.207 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/swagger/swagger-ui-standalone-preset.js - 200 230280 text/javascript 91.983ms
2025-01-19 04:14:42.207 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/swagger/swagger-ui.css - 200 152034 text/css 92.1602ms
2025-01-19 04:14:42.282 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/_vs/browserLink - 200 null text/javascript; charset=UTF-8 158.7175ms
2025-01-19 04:14:42.287 +06:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-01-19 04:14:42.291 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/swagger/swagger-ui-bundle.js - 200 1456926 text/javascript 176.352ms
2025-01-19 04:14:42.462 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/swagger/v1/swagger.json - null null
2025-01-19 04:14:42.478 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 16.349ms
2025-01-19 04:14:42.489 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/swagger/favicon-32x32.png - null null
2025-01-19 04:14:42.492 +06:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-01-19 04:14:42.494 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/swagger/favicon-32x32.png - 200 628 image/png 5.4994ms
2025-01-19 04:15:54.302 +06:00 [INF] Request starting HTTP/2 POST https://localhost:7292/api/users - application/json 84
2025-01-19 04:15:54.324 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.UsersController.Create (UserPhoneTest.Api)'
2025-01-19 04:15:54.348 +06:00 [INF] Route matched with {action = "Create", controller = "Users"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(UserPhoneTest.Application.Contracts.Users.CreateUserRequest, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.UsersController (UserPhoneTest.Api).
2025-01-19 04:15:55.775 +06:00 [INF] Executed DbCommand (54ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Email] = @__email_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-01-19 04:15:55.809 +06:00 [INF] Executing BadRequestObjectResult, writing value of type 'UserPhoneTest.Application.Abstractions.Error'.
2025-01-19 04:15:55.817 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.UsersController.Create (UserPhoneTest.Api) in 1462.6829ms
2025-01-19 04:15:55.818 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.UsersController.Create (UserPhoneTest.Api)'
2025-01-19 04:15:55.825 +06:00 [INF] Request finished HTTP/2 POST https://localhost:7292/api/users - 400 null application/json; charset=utf-8 1522.8924ms
2025-01-19 04:16:06.245 +06:00 [INF] Request starting HTTP/2 POST https://localhost:7292/api/users - application/json 88
2025-01-19 04:16:06.252 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.UsersController.Create (UserPhoneTest.Api)'
2025-01-19 04:16:06.255 +06:00 [INF] Route matched with {action = "Create", controller = "Users"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(UserPhoneTest.Application.Contracts.Users.CreateUserRequest, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.UsersController (UserPhoneTest.Api).
2025-01-19 04:16:06.307 +06:00 [INF] Executed DbCommand (4ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Email] = @__email_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-01-19 04:16:06.452 +06:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Date), @p1='?' (Size = 450), @p2='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([DateOfBirth], [Email], [Name])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2025-01-19 04:16:06.478 +06:00 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-01-19 04:16:06.480 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.UsersController.Create (UserPhoneTest.Api) in 220.8592ms
2025-01-19 04:16:06.482 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.UsersController.Create (UserPhoneTest.Api)'
2025-01-19 04:16:06.484 +06:00 [INF] Request finished HTTP/2 POST https://localhost:7292/api/users - 200 0 null 239.1182ms
2025-01-19 04:16:45.839 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/api/phones?userId=2 - null null
2025-01-19 04:16:45.851 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.PhonesController.GetUserPhones (UserPhoneTest.Api)'
2025-01-19 04:16:45.856 +06:00 [INF] Route matched with {action = "GetUserPhones", controller = "Phones"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserPhones(Int32, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.PhonesController (UserPhoneTest.Api).
2025-01-19 04:16:45.890 +06:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Id] = @__userId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-01-19 04:16:45.930 +06:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[PhoneNumber], [p].[UserId]
FROM [Phones] AS [p]
WHERE [p].[UserId] = @__userId_0
2025-01-19 04:16:45.946 +06:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[UserPhoneTest.Application.Contracts.Phones.PhoneResponse, UserPhoneTest.Application, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-01-19 04:16:45.949 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.PhonesController.GetUserPhones (UserPhoneTest.Api) in 90.8256ms
2025-01-19 04:16:45.952 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.PhonesController.GetUserPhones (UserPhoneTest.Api)'
2025-01-19 04:16:45.953 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/api/phones?userId=2 - 200 null application/json; charset=utf-8 113.5661ms
2025-01-19 04:16:57.738 +06:00 [INF] Request starting HTTP/2 POST https://localhost:7292/api/phones - application/json 53
2025-01-19 04:16:57.742 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.PhonesController.AddUserPhone (UserPhoneTest.Api)'
2025-01-19 04:16:57.746 +06:00 [INF] Route matched with {action = "AddUserPhone", controller = "Phones"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddUserPhone(UserPhoneTest.Application.Contracts.Phones.AddUserPhoneRequest, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.PhonesController (UserPhoneTest.Api).
2025-01-19 04:16:57.768 +06:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Id] = @__userId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-01-19 04:16:57.785 +06:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 15), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Phones] ([PhoneNumber], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1);
2025-01-19 04:16:57.789 +06:00 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-01-19 04:16:57.790 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.PhonesController.AddUserPhone (UserPhoneTest.Api) in 39.5841ms
2025-01-19 04:16:57.791 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.PhonesController.AddUserPhone (UserPhoneTest.Api)'
2025-01-19 04:16:57.791 +06:00 [INF] Request finished HTTP/2 POST https://localhost:7292/api/phones - 200 0 null 54.1633ms
2025-01-19 04:17:05.027 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/api/phones?userId=2 - null null
2025-01-19 04:17:05.036 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.PhonesController.GetUserPhones (UserPhoneTest.Api)'
2025-01-19 04:17:05.038 +06:00 [INF] Route matched with {action = "GetUserPhones", controller = "Phones"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserPhones(Int32, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.PhonesController (UserPhoneTest.Api).
2025-01-19 04:17:05.046 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Id] = @__userId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-01-19 04:17:05.062 +06:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[PhoneNumber], [p].[UserId]
FROM [Phones] AS [p]
WHERE [p].[UserId] = @__userId_0
2025-01-19 04:17:05.068 +06:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[UserPhoneTest.Application.Contracts.Phones.PhoneResponse, UserPhoneTest.Application, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-01-19 04:17:05.072 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.PhonesController.GetUserPhones (UserPhoneTest.Api) in 31.2105ms
2025-01-19 04:17:05.074 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.PhonesController.GetUserPhones (UserPhoneTest.Api)'
2025-01-19 04:17:05.075 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/api/phones?userId=2 - 200 null application/json; charset=utf-8 48.0062ms
2025-01-19 04:17:11.507 +06:00 [INF] Request starting HTTP/2 POST https://localhost:7292/api/phones - application/json 53
2025-01-19 04:17:11.514 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.PhonesController.AddUserPhone (UserPhoneTest.Api)'
2025-01-19 04:17:11.517 +06:00 [INF] Route matched with {action = "AddUserPhone", controller = "Phones"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddUserPhone(UserPhoneTest.Application.Contracts.Phones.AddUserPhoneRequest, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.PhonesController (UserPhoneTest.Api).
2025-01-19 04:17:11.523 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Id] = @__userId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-01-19 04:17:11.537 +06:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 15), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Phones] ([PhoneNumber], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1);
2025-01-19 04:17:11.558 +06:00 [ERR] An exception occurred in the database while saving changes for context type 'UserPhoneTest.Infrastructure.DbContexts.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Не удается вставить повторяющуюся строку ключа в объект "dbo.Phones" с уникальным индексом "IX_Phone_PhoneNumber". Повторяющееся значение ключа: (+71671110996792).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c1ac6718-2b54-4733-826d-1ad7fe9a6437
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Не удается вставить повторяющуюся строку ключа в объект "dbo.Phones" с уникальным индексом "IX_Phone_PhoneNumber". Повторяющееся значение ключа: (+71671110996792).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c1ac6718-2b54-4733-826d-1ad7fe9a6437
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-19 04:17:11.664 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.PhonesController.AddUserPhone (UserPhoneTest.Api) in 145.3411ms
2025-01-19 04:17:11.669 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.PhonesController.AddUserPhone (UserPhoneTest.Api)'
2025-01-19 04:17:11.739 +06:00 [ERR] An unhandled exception occurred.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Не удается вставить повторяющуюся строку ключа в объект "dbo.Phones" с уникальным индексом "IX_Phone_PhoneNumber". Повторяющееся значение ключа: (+71671110996792).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c1ac6718-2b54-4733-826d-1ad7fe9a6437
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UserPhoneTest.Application.Features.Phones.AddUserPhone.AddUserPhoneCommandHandler.Handle(AddUserPhoneCommand request, CancellationToken cancellationToken) in D:\Projects\UserPhoneTest\UserPhoneTest.Application\Features\Phones\AddUserPhone\AddUserPhoneCommandHandler.cs:line 33
   at UserPhoneTest.Api.Controllers.PhonesController.AddUserPhone(AddUserPhoneRequest request, CancellationToken cancellationToken) in D:\Projects\UserPhoneTest\UserPhoneTest.Api\Controllers\PhonesController.cs:line 33
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at UserPhoneTest.Api.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext context) in D:\Projects\UserPhoneTest\UserPhoneTest.Api\Middlewares\ExceptionHandlingMiddleware.cs:line 12
2025-01-19 04:17:11.760 +06:00 [INF] Request finished HTTP/2 POST https://localhost:7292/api/phones - 500 null application/json; charset=utf-8 252.7053ms
2025-01-19 04:18:17.112 +06:00 [INF] Request starting HTTP/2 GET https://localhost:7292/api/phones?userId=2 - null null
2025-01-19 04:18:17.145 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.PhonesController.GetUserPhones (UserPhoneTest.Api)'
2025-01-19 04:18:17.146 +06:00 [INF] Route matched with {action = "GetUserPhones", controller = "Phones"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserPhones(Int32, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.PhonesController (UserPhoneTest.Api).
2025-01-19 04:18:17.162 +06:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Id] = @__userId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-01-19 04:18:17.166 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[PhoneNumber], [p].[UserId]
FROM [Phones] AS [p]
WHERE [p].[UserId] = @__userId_0
2025-01-19 04:18:17.168 +06:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[UserPhoneTest.Application.Contracts.Phones.PhoneResponse, UserPhoneTest.Application, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-01-19 04:18:17.169 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.PhonesController.GetUserPhones (UserPhoneTest.Api) in 21.2143ms
2025-01-19 04:18:17.175 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.PhonesController.GetUserPhones (UserPhoneTest.Api)'
2025-01-19 04:18:17.176 +06:00 [INF] Request finished HTTP/2 GET https://localhost:7292/api/phones?userId=2 - 200 null application/json; charset=utf-8 64.233ms
2025-01-19 04:18:30.939 +06:00 [INF] Request starting HTTP/2 DELETE https://localhost:7292/api/phones/1 - null null
2025-01-19 04:18:30.944 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api)'
2025-01-19 04:18:30.948 +06:00 [INF] Route matched with {action = "DeleteUserPhone", controller = "Phones"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] DeleteUserPhone(Int32, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.PhonesController (UserPhoneTest.Api).
2025-01-19 04:18:30.960 +06:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[PhoneNumber], [p].[UserId]
FROM [Phones] AS [p]
WHERE [p].[Id] = @__id_0
2025-01-19 04:18:30.977 +06:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
DELETE FROM [Phones]
OUTPUT 1
WHERE [Id] = @p0;
2025-01-19 04:18:30.982 +06:00 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-01-19 04:18:30.982 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api) in 32.9799ms
2025-01-19 04:18:30.983 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api)'
2025-01-19 04:18:30.984 +06:00 [INF] Request finished HTTP/2 DELETE https://localhost:7292/api/phones/1 - 200 0 null 45.0813ms
2025-01-19 04:18:32.321 +06:00 [INF] Request starting HTTP/2 DELETE https://localhost:7292/api/phones/1 - null null
2025-01-19 04:18:32.326 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api)'
2025-01-19 04:18:32.327 +06:00 [INF] Route matched with {action = "DeleteUserPhone", controller = "Phones"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] DeleteUserPhone(Int32, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.PhonesController (UserPhoneTest.Api).
2025-01-19 04:18:32.331 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[PhoneNumber], [p].[UserId]
FROM [Phones] AS [p]
WHERE [p].[Id] = @__id_0
2025-01-19 04:18:32.334 +06:00 [INF] Executing BadRequestObjectResult, writing value of type 'UserPhoneTest.Application.Abstractions.Error'.
2025-01-19 04:18:32.335 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api) in 6.9368ms
2025-01-19 04:18:32.336 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api)'
2025-01-19 04:18:32.338 +06:00 [INF] Request finished HTTP/2 DELETE https://localhost:7292/api/phones/1 - 400 null application/json; charset=utf-8 17.0313ms
2025-01-19 04:18:56.530 +06:00 [INF] Request starting HTTP/2 POST https://localhost:7292/api/phones - application/json 53
2025-01-19 04:18:56.538 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.PhonesController.AddUserPhone (UserPhoneTest.Api)'
2025-01-19 04:18:56.539 +06:00 [INF] Route matched with {action = "AddUserPhone", controller = "Phones"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddUserPhone(UserPhoneTest.Application.Contracts.Phones.AddUserPhoneRequest, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.PhonesController (UserPhoneTest.Api).
2025-01-19 04:18:56.553 +06:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Id] = @__userId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-01-19 04:18:56.563 +06:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 15), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Phones] ([PhoneNumber], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1);
2025-01-19 04:18:56.567 +06:00 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-01-19 04:18:56.569 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.PhonesController.AddUserPhone (UserPhoneTest.Api) in 26.8699ms
2025-01-19 04:18:56.572 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.PhonesController.AddUserPhone (UserPhoneTest.Api)'
2025-01-19 04:18:56.574 +06:00 [INF] Request finished HTTP/2 POST https://localhost:7292/api/phones - 200 0 null 45.305ms
2025-01-19 04:19:01.145 +06:00 [INF] Request starting HTTP/2 DELETE https://localhost:7292/api/phones/1 - null null
2025-01-19 04:19:01.151 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api)'
2025-01-19 04:19:01.151 +06:00 [INF] Route matched with {action = "DeleteUserPhone", controller = "Phones"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] DeleteUserPhone(Int32, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.PhonesController (UserPhoneTest.Api).
2025-01-19 04:19:01.169 +06:00 [INF] Executed DbCommand (13ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[PhoneNumber], [p].[UserId]
FROM [Phones] AS [p]
WHERE [p].[Id] = @__id_0
2025-01-19 04:19:01.174 +06:00 [INF] Executing BadRequestObjectResult, writing value of type 'UserPhoneTest.Application.Abstractions.Error'.
2025-01-19 04:19:01.176 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api) in 22.5305ms
2025-01-19 04:19:01.179 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api)'
2025-01-19 04:19:01.182 +06:00 [INF] Request finished HTTP/2 DELETE https://localhost:7292/api/phones/1 - 400 null application/json; charset=utf-8 37.3778ms
2025-01-19 04:19:12.879 +06:00 [INF] Request starting HTTP/2 DELETE https://localhost:7292/api/phones/1 - null null
2025-01-19 04:19:12.884 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api)'
2025-01-19 04:19:12.885 +06:00 [INF] Route matched with {action = "DeleteUserPhone", controller = "Phones"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] DeleteUserPhone(Int32, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.PhonesController (UserPhoneTest.Api).
2025-01-19 04:19:12.889 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[PhoneNumber], [p].[UserId]
FROM [Phones] AS [p]
WHERE [p].[Id] = @__id_0
2025-01-19 04:19:12.892 +06:00 [INF] Executing BadRequestObjectResult, writing value of type 'UserPhoneTest.Application.Abstractions.Error'.
2025-01-19 04:19:12.893 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api) in 5.6089ms
2025-01-19 04:19:12.894 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api)'
2025-01-19 04:19:12.895 +06:00 [INF] Request finished HTTP/2 DELETE https://localhost:7292/api/phones/1 - 400 null application/json; charset=utf-8 16.0126ms
2025-01-19 04:19:32.037 +06:00 [INF] Request starting HTTP/2 DELETE https://localhost:7292/api/phones/3 - null null
2025-01-19 04:19:32.047 +06:00 [INF] Executing endpoint 'UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api)'
2025-01-19 04:19:32.050 +06:00 [INF] Route matched with {action = "DeleteUserPhone", controller = "Phones"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] DeleteUserPhone(Int32, System.Threading.CancellationToken) on controller UserPhoneTest.Api.Controllers.PhonesController (UserPhoneTest.Api).
2025-01-19 04:19:32.057 +06:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[PhoneNumber], [p].[UserId]
FROM [Phones] AS [p]
WHERE [p].[Id] = @__id_0
2025-01-19 04:19:32.072 +06:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
DELETE FROM [Phones]
OUTPUT 1
WHERE [Id] = @p0;
2025-01-19 04:19:32.076 +06:00 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-01-19 04:19:32.076 +06:00 [INF] Executed action UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api) in 22.5846ms
2025-01-19 04:19:32.077 +06:00 [INF] Executed endpoint 'UserPhoneTest.Api.Controllers.PhonesController.DeleteUserPhone (UserPhoneTest.Api)'
2025-01-19 04:19:32.080 +06:00 [INF] Request finished HTTP/2 DELETE https://localhost:7292/api/phones/3 - 200 0 null 43.2877ms
